<!DOCTYPE html>
<html lang="es">
  <head>
    <title>Pedro Villarroel's Webpage</title>
    <!-- Styling -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://ptdrow.github.io/css/styleposts.css" type="text/css" rel="stylesheet">
    <link href="https://ptdrow.github.io/css/style.css" type="text/css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Life+Savers" type="text/css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Dancing+Script" type="text/css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Open+Sans" type="text/css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Iconsolata" type="text/css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link href="style2.css" type="text/css" rel="stylesheet">
    <!-- Alternate languages -->
    <link rel="alternate" href="https://ptdrow.github.io/2017/05/04/r_strava_es.html" hreflang="es">
    <!-- Google Analytics -->
    <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-63590859-3', 'auto');
          ga('send', 'pageview');
    </script>
  </head>
  <body>
    <div class="navigation">
      <h1><span class="first">P</span>edro <span class="first">D</span>. <span class="first">V</span>illarroel <span class="first">F</span>.</h1>
      <p>Espa&ntilde;ol<p>
        <ul>
            <li><a id="home" href="https://ptdrow.github.io">Inicio</a></li>
            <li class="dropdown">
              <a href="https://ptdrow.github.io/tutoriales.html" class="dropbtn">Tutoriales</a>
            <!--  <></>   
            <div class="dropdown-content">
              <a id= "pyt" href="#">Python</a>
              <a id= "r" href="#">R</a>
              <a id= "rhino" href="#">Rhinoceros</a>
            </div> -->
            </li>
            <li><a href="#contact">Contacto</a></li>
        </ul>
      </div>
    <div class="main">
        <h1>Cómo acceder al API de Strava con R</h1>
        <p><span class="first">E</span>n este tutorial les muestro como utilizar la librería rStrava para descargar data directamente del API de Strava, la cual podríamos luego analizar y graficar con los demás paquetes en R.</p>
		<p>Para obtener la data de Strava en R podemos utilizar el paquete rStrava el cual tiene funciones tanto para hacer web scrapping en las páginas de Strava como para conectarse directamente con el API. En este tutorial usaremos estas últimas.</p>
		<p>Primero instalamos los paquetes que vamos a utilizar:</p>
		<div class="code">
            <p>install.packages(<span class="green">'devtools'</span>,<span class="green">'httr'</span>)</p>
        </div>
		<p>devtools lo utilizaremos para instalar rStrava desde github, ya que no está en los repositorios de CRAN, y httr es una dependencia de rStrava que se utiliza para autenticación y descarga del API. Si ya tienes instalados estos paquetes usa library o require.</p>
		<p>Ahora instalamos rStrava:</p>
		<div class="code">
			<p>devtools::install_github(<span class="green">'fawda123/rStrava'</span>)</p>
		</div>
		<p>Para poder descargar data del API de Strava necesitamos registrar una aplicación <a href="https://www.strava.com/settings" target="_blank">aquí</a>. Llena los datos de tu nueva aplicación y en la casilla de "Dominio de devolución de la llamada de autorización" colocas "localhost:1410".</p>
		<p>Una vez registrada la nueva aplicación Strava nos va a asignar un ID de cliente y un Secreto de cliente que los guardaremos en sus respectivas variables en R para proceder a autenticar nuestra sesión con la aplicación:</p>
		<div class="code">
			<p>app_name <- # Elegido por el usuario</p>
			<p>app_client_id  <- <span class="green">'myid'</span> # Asignado por Strava</p>
			<p>app_secret <- <span class="green">'xxxxxxxx'</span> # secreto alfanumerico assignado por Strava</p>	
		</div>
		<p>Si quieres que en los resultados de tu aplicación aparezca data privada a la que tienes acceso desde tu cuenta usa:</p>
		<div class="code">
			<p>app_scope <- <span class="green">'view_private'</span></p>
		</div>
		<p>De lo contrario usa:</p>
		<div class="code">
			<p>app_scope <- <span class="green">'public'</span></p>
		</div>
		<p>Ahora con estas variables autenticamos nuestra aplicación para obtener un token de acceso al API:</p>
		<div class="code">
			<p>strava_token <- strava_oauth(app_name, app_client_id, app_secret, app_scope)</p>
		</div>
	  	<p>esta función abrirá una ventana de tu navegador predeterminado hacia la página de autenticación de tu aplicación. Si no has abierto tu sesión de Strava te pedirá que lo hagas y luego preguntará si quieres permitir el acceso a la aplicación. Una vez que le des acceso aparece un mensaje como este: "Authentication complete. Please close this page and return to R."</p>
		<p>Ya puedes cerrar el navegador y continuar en R.</p>
		<p>La respuesta de Strava fue grabada en la variable strava_token, sin embargo no está configurada de forma que sea útil para las funciones de rStrava, por lo que usamos la función config de httr para ello:</p>
		<div class="code">
			<p>stoken <- config(token = strava_token)</p>
		</div>
		<p>Ahora sí tenemos el token que usaremos en todas la funciones de API de rStrava. Este token es válido para esta aplicación, con el usuario que abrió su sesión y con los alcances (scopes) preseleccionados. Si quieres cambiar alguno de estos valores tienes que repetir el proceso, sin embargo puedes guardar cada token en una variable diferente y usarlos cuando requieras los cambios.</p>
		<p>Procedemos a verificar que stoken funciona con las funciones de rStrava:</p>
		<div class="code">
			<p>my_info <- get_athlete(stoken)</p>
			<p>my_info$username</p>
			<p>my_info$friend_count</p>
			<p>my_info$follower_count</p>
		</div>
		<p>Si la data se descargó deberías ver tu nombre de usuario y la cantidad de amigos y seguidores que tienes en Strava.</p>
		<p>Ahora ya tienes acceso al API de Strava desde R. Puedes ver una lista de las funcionalidades del paquete rStrava usando la ayuda:</p>
		<div class="code">
			<p>help.search(<span class="green">'token'</span>, package = <span class="green">'rStrava'</span>)</p>
		</div>
		<p>Y ahora a jugar con la data y R para ver qué información puedes revelar. Algunos ejemplos de lo que puedes hacer con esta data:</p>
		<ul><li>Visualizar tu red social de amigos en Strava.</li>
            <li>Hacer heatmaps personalizados con tus recorridos en Strava.</li>
            <li>Analizar las conexiones entre los atletas PRO de Strava.</li>
            <li>Crear estadísticas personalizadas sobre tu rendimiento o los esfuerzos en uno o varios segmentos.</li>
			<li>Ver el historial de personas que han sido KOMs o QOMs en un segmento.</li>
		</ul>
		<p>Si te fue útil el post déjame y comentario y comparte los análisis que puedes hacer con tu data. Saludos</p>
		<div id="disqus_thread"></div>
		<script>
		var disqus_config = function () {
		this.page.url = 'https://ptdrow.github.io/2017/05/04/r_strava_es.html';
		this.page.identifier = 'rStravaIntro';
		};
		(function() { // DON'T EDIT BELOW THIS LINE
		var d = document, s = d.createElement('script');
		s.src = 'https://ptdrow.disqus.com/embed.js';
		s.setAttribute('data-timestamp', +new Date());
		(d.head || d.body).appendChild(s);
		})();
		</script>
		<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    </div>
    <h1 id="contact">Contacto</h1>
    <div class="foot">
        <a id= "facebook" href="https://www.facebook.com/ptdrow" target="_blank"><img src="https://ptdrow.github.io/images/facebookMed.png"></a>
        <a id= "strava" href="https://www.strava.com/athletes/ptdrow" target="_blank"><img src="https://ptdrow.github.io/images/stravaMed.png"></a>
        <a id= "instagram" href="https://www.instagram.com/ptdrow/" target="_blank"><img src="https://ptdrow.github.io/images/instaMed.png"></a>
        <a id= "twitter" href="https://twitter.com/pedrodvf" target="_blank"><img src="https://ptdrow.github.io/images/twitterMed.png"></a>
    </div>
    <div class="copy">
        <p>&copy; 2017 Pedro Villarroel</p>
    </div>
  </body>
</html>
<!--  <></>   -->
